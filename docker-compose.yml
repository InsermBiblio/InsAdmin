node:
  image: node:8.12.0-alpine
  volumes:
    - .:/app
  working_dir: /app

npm:
  extends:
    file: ./docker-compose.yml
    service: node
  environment:
    http_proxy: ${http_proxy}
    https_proxy: ${https_proxy}
    no_proxy: "localhost,127.0.0.1,"
  entrypoint: ["npm"]

build:
  extends:
    file: ./docker-compose.yml
    service: node
  environment:
    NODE_ENV: production
    REACT_APP_BIBADMIN_HOST: ${REACT_APP_BIBADMIN_HOST}
    REACT_APP_BIBAPI_HOST: ${REACT_APP_BIBAPI_HOST}
  command: npm run build --production
